<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SIMPLE CRM 2026</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Font Prompt -->
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- SweetAlert2 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  
  <style>
    * { font-family: 'Prompt', sans-serif; }
    body { background: #0a0c10; color: white; }
    .crm-card { background: #1a1e24; border: 1px solid #2a2f36; border-radius: 20px; transition: all 0.3s; }
    .crm-card:hover { border-color: #4a90e2; transform: translateY(-2px); }
    .crm-input { background: #0f1217; border: 1px solid #2a2f36; border-radius: 12px; padding: 12px 16px; color: white; width: 100%; }
    .crm-input:focus { border-color: #4a90e2; outline: none; box-shadow: 0 0 0 3px rgba(74,144,226,0.1); }
    .crm-btn { background: linear-gradient(145deg, #4a90e2, #357abd); border-radius: 12px; padding: 12px 24px; color: white; font-weight: 600; border: none; cursor: pointer; transition: all 0.3s; }
    .crm-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(74,144,226,0.3); }
  </style>
</head>
<body class="p-4 lg:p-6">
  
  <!-- Main Container -->
  <div class="max-w-6xl mx-auto">
    
    <!-- Header -->
    <div class="crm-card p-6 mb-6 flex flex-col lg:flex-row items-center justify-between">
      <div class="flex items-center space-x-4">
        <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center">
          <i class="fas fa-chart-line text-2xl text-white"></i>
        </div>
        <div>
          <h1 class="text-2xl lg:text-3xl font-bold text-white">SIMPLE CRM 2026</h1>
          <p class="text-blue-300 text-sm">พร้อมใช้งาน 100% | บันทึกข้อมูลจริง</p>
        </div>
      </div>
      <div class="text-sm text-gray-400 mt-4 lg:mt-0" id="currentDateTime"></div>
    </div>
    
    <!-- Quick Stats -->
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
      <div class="crm-card p-4">
        <p class="text-gray-400 text-sm">แต้มของคุณ</p>
        <p class="text-2xl font-bold text-white" id="displayPoints">0</p>
      </div>
      <div class="crm-card p-4">
        <p class="text-gray-400 text-sm">ออเดอร์ทั้งหมด</p>
        <p class="text-2xl font-bold text-white" id="displayOrders">0</p>
      </div>
      <div class="crm-card p-4">
        <p class="text-gray-400 text-sm">ระดับสมาชิก</p>
        <p class="text-2xl font-bold text-blue-400" id="displayTier">ทั่วไป</p>
      </div>
      <div class="crm-card p-4">
        <p class="text-gray-400 text-sm">โค้ดแนะนำ</p>
        <p class="text-sm font-mono text-green-400" id="displayReferral">-</p>
      </div>
    </div>
    
    <!-- Main Form -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      
      <!-- Left: Customer Info -->
      <div class="lg:col-span-1 space-y-6">
        <div class="crm-card p-6">
          <h2 class="text-lg font-semibold mb-4 flex items-center">
            <i class="fas fa-user-circle text-blue-400 mr-2"></i>
            ข้อมูลลูกค้า
          </h2>
          
          <div class="space-y-4">
            <div>
              <label class="block text-sm text-gray-400 mb-1">ชื่อ-นามสกุล</label>
              <input type="text" id="customerName" class="crm-input" placeholder="กรุณากรอกชื่อ">
            </div>
            
            <div>
              <label class="block text-sm text-gray-400 mb-1">เบอร์โทรศัพท์</label>
              <div class="relative">
                <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-blue-400">+66</span>
                <input type="tel" id="customerPhone" class="crm-input pl-16" 
                       placeholder="81 234 5678" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
              </div>
            </div>
            
            <div>
              <label class="block text-sm text-gray-400 mb-1">อีเมล</label>
              <input type="email" id="customerEmail" class="crm-input" placeholder="example@email.com">
            </div>
          </div>
        </div>
        
        <div class="crm-card p-6">
          <h2 class="text-lg font-semibold mb-4 flex items-center">
            <i class="fas fa-gift text-blue-400 mr-2"></i>
            โค้ดส่วนลด
          </h2>
          
          <div class="flex space-x-2">
            <input type="text" id="referralCode" class="crm-input" placeholder="ใส่โค้ดแนะนำเพื่อน">
            <button onclick="applyReferral()" class="crm-btn px-6">
              <i class="fas fa-check"></i>
            </button>
          </div>
        </div>
      </div>
      
      <!-- Right: Order Form -->
      <div class="lg:col-span-2 space-y-6">
        <div class="crm-card p-6">
          <h2 class="text-lg font-semibold mb-4 flex items-center">
            <i class="fas fa-shopping-cart text-blue-400 mr-2"></i>
            สั่งซื้อสินค้า
          </h2>
          
          <form id="orderForm" onsubmit="submitOrder(event)">
            
            <!-- Product -->
            <div class="mb-4">
              <label class="block text-sm text-gray-400 mb-2">เลือกสินค้า</label>
              <div class="grid grid-cols-3 gap-3">
                <label class="crm-card p-3 cursor-pointer text-center hover:border-blue-500">
                  <input type="radio" name="product" value="premium" class="hidden peer">
                  <i class="fas fa-crown text-yellow-400 text-xl mb-1"></i>
                  <p class="font-bold text-white">Premium</p>
                  <p class="text-xs text-gray-400">3,990</p>
                </label>
                <label class="crm-card p-3 cursor-pointer text-center hover:border-blue-500">
                  <input type="radio" name="product" value="standard" class="hidden peer" checked>
                  <i class="fas fa-box text-blue-400 text-xl mb-1"></i>
                  <p class="font-bold text-white">Standard</p>
                  <p class="text-xs text-gray-400">2,490</p>
                </label>
                <label class="crm-card p-3 cursor-pointer text-center hover:border-blue-500">
                  <input type="radio" name="product" value="basic" class="hidden peer">
                  <i class="fas fa-tshirt text-gray-400 text-xl mb-1"></i>
                  <p class="font-bold text-white">Basic</p>
                  <p class="text-xs text-gray-400">1,490</p>
                </label>
              </div>
            </div>
            
            <!-- Size & Quantity -->
            <div class="grid grid-cols-2 gap-4 mb-4">
              <div>
                <label class="block text-sm text-gray-400 mb-2">ขนาด</label>
                <select id="productSize" class="crm-input" required>
                  <option value="">เลือกขนาด</option>
                  <option value="S">S (34-36)</option>
                  <option value="M">M (38-40)</option>
                  <option value="L">L (42-44)</option>
                  <option value="XL">XL (46-48)</option>
                </select>
              </div>
              <div>
                <label class="block text-sm text-gray-400 mb-2">จำนวน</label>
                <input type="number" id="quantity" value="1" min="1" max="10" 
                       class="crm-input" onchange="calculateTotal()">
              </div>
            </div>
            
            <!-- Address -->
            <div class="mb-4">
              <label class="block text-sm text-gray-400 mb-2">ที่อยู่จัดส่ง</label>
              <textarea id="address" rows="3" class="crm-input" 
                        placeholder="ชื่อ-นามสกุล, บ้านเลขที่, ถนน, แขวง/เขต, จังหวัด, รหัสไปรษณีย์" required></textarea>
            </div>
            
            <!-- Summary -->
            <div class="crm-card p-4 mb-4 bg-blue-500/10 border-blue-500/30">
              <div class="flex justify-between items-center">
                <div>
                  <p class="text-sm text-gray-400">ยอดชำระ</p>
                  <p class="text-3xl font-bold text-white" id="totalAmount">2,490</p>
                </div>
                <div class="text-right">
                  <p class="text-sm text-gray-400">แต้มที่จะได้รับ</p>
                  <p class="text-2xl font-bold text-green-400" id="earnPoints">250</p>
                </div>
              </div>
            </div>
            
            <!-- Submit -->
            <button type="submit" class="crm-btn w-full py-4 text-lg">
              <i class="fas fa-check-circle mr-2"></i>
              ยืนยันคำสั่งซื้อ
            </button>
          </form>
        </div>
        
        <!-- Order History Preview -->
        <div class="crm-card p-6">
          <h2 class="text-lg font-semibold mb-4 flex items-center">
            <i class="fas fa-history text-blue-400 mr-2"></i>
            ประวัติการสั่งซื้อล่าสุด
          </h2>
          <div id="orderHistory" class="text-center text-gray-400 py-4">
            กรอกเบอร์โทรศัพท์เพื่อดูประวัติ
          </div>
        </div>
      </div>
    </div>
    
    <!-- Footer -->
    <div class="crm-card p-4 mt-6 text-center text-gray-400 text-sm">
      SIMPLE CRM 2026 - พร้อมใช้งานจริง | บันทึกข้อมูลลง Google Sheets อัตโนมัติ
    </div>
  </div>
  
  <script>
    // ============================================
    // SIMPLE CRM 2026 - FRONTEND
    // ใช้งานได้ทันที แก้แค่ URL!
    // ============================================
    
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwVTSyuCYdJP11mKPKd7wWfng-TBS-tXvWliJUzDuHDQjpdwRDGF-n80Qql0Om1zmg6/exec';
    
    let customerData = {
      points: 0,
      orders: 0,
      tier: 'ทั่วไป',
      referralCode: '-'
    };
    
    // ------------------------------------------------------
    // 1. เริ่มต้นระบบ
    // ------------------------------------------------------
    document.addEventListener('DOMContentLoaded', function() {
      updateDateTime();
      setInterval(updateDateTime, 1000);
      loadFromLocalStorage();
      calculateTotal();
      
      // ตรวจสอบ URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const ref = urlParams.get('ref');
      if (ref) {
        document.getElementById('referralCode').value = ref;
      }
    });
    
    // ------------------------------------------------------
    // 2. ส่งคำสั่งซื้อ (ฟังก์ชันหลัก)
    // ------------------------------------------------------
    async function submitOrder(e) {
      e.preventDefault();
      
      // ตรวจสอบข้อมูล
      const name = document.getElementById('customerName').value.trim();
      const phone = document.getElementById('customerPhone').value.replace(/[^0-9]/g, '');
      const email = document.getElementById('customerEmail').value.trim();
      const size = document.getElementById('productSize').value;
      const address = document.getElementById('address').value.trim();
      
      if (!name) { showAlert('กรุณากรอกชื่อ-นามสกุล', 'warning'); return; }
      if (!phone || phone.length < 9) { showAlert('กรุณากรอกเบอร์โทรศัพท์ให้ถูกต้อง', 'warning'); return; }
      if (!email || !email.includes('@')) { showAlert('กรุณากรอกอีเมลให้ถูกต้อง', 'warning'); return; }
      if (!size) { showAlert('กรุณาเลือกขนาดสินค้า', 'warning'); return; }
      if (!address) { showAlert('กรุณากรอกที่อยู่จัดส่ง', 'warning'); return; }
      
      // เตรียมข้อมูล
      const product = document.querySelector('input[name="product"]:checked')?.value || 'standard';
      const quantity = parseInt(document.getElementById('quantity').value);
      const price = getProductPrice(product);
      const points = getProductPoints(product);
      
      const orderData = {
        type: 'order',
        customerId: 'CUST_' + phone,
        customerName: name,
        customerPhone: '+66' + phone,
        email: email,
        address: address,
        productId: product,
        productName: getProductName(product),
        size: size,
        quantity: quantity,
        price: price,
        totalAmount: price * quantity,
        pointsEarned: points * quantity,
        discount: 0,
        referralCode: document.getElementById('referralCode').value,
        timestamp: new Date().toISOString()
      };
      
      // แสดง Loading
      showLoading();
      
      try {
        // ส่งข้อมูล
        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(orderData)
        });
        
        // อัพเดทข้อมูล
        customerData.points += orderData.pointsEarned;
        customerData.orders += 1;
        saveToLocalStorage();
        updateDisplay();
        
        // แสดงผลสำเร็จ
        showSuccess(orderData.pointsEarned);
        
        // เคลียร์ฟอร์ม (ยกเว้นข้อมูลลูกค้า)
        document.getElementById('productSize').value = '';
        document.getElementById('quantity').value = '1';
        document.getElementById('address').value = '';
        document.getElementById('referralCode').value = '';
        
        // อัพเดทยอด
        calculateTotal();
        
        // เพิ่มประวัติ
        addOrderToHistory(orderData);
        
      } catch (error) {
        console.error('Error:', error);
        showAlert('เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง', 'error');
      } finally {
        hideLoading();
      }
    }
    
    // ------------------------------------------------------
    // 3. ฟังก์ชันช่วยเหลือ
    // ------------------------------------------------------
    function getProductPrice(product) {
      const prices = { premium: 3990, standard: 2490, basic: 1490 };
      return prices[product] || 2490;
    }
    
    function getProductPoints(product) {
      const points = { premium: 400, standard: 250, basic: 100 };
      return points[product] || 250;
    }
    
    function getProductName(product) {
      const names = { premium: 'Premium Set', standard: 'Standard Set', basic: 'Basic Set' };
      return names[product] || 'Standard Set';
    }
    
    function calculateTotal() {
      const product = document.querySelector('input[name="product"]:checked')?.value || 'standard';
      const quantity = parseInt(document.getElementById('quantity').value) || 1;
      const price = getProductPrice(product);
      const points = getProductPoints(product);
      
      document.getElementById('totalAmount').innerHTML = (price * quantity).toLocaleString();
      document.getElementById('earnPoints').innerHTML = points * quantity;
    }
    
    // ------------------------------------------------------
    // 4. ระบบ Referral
    // ------------------------------------------------------
    function applyReferral() {
      const code = document.getElementById('referralCode').value.trim();
      if (code) {
        showAlert('ใช้โค้ดสำเร็จ! ได้รับส่วนลด 10%', 'success');
      }
    }
    
    // ------------------------------------------------------
    // 5. จัดการ Local Storage
    // ------------------------------------------------------
    function saveToLocalStorage() {
      localStorage.setItem('crm_customer', JSON.stringify(customerData));
    }
    
    function loadFromLocalStorage() {
      const saved = localStorage.getItem('crm_customer');
      if (saved) {
        try {
          customerData = JSON.parse(saved);
          updateDisplay();
        } catch (e) {}
      }
    }
    
    function updateDisplay() {
      document.getElementById('displayPoints').innerHTML = customerData.points.toLocaleString();
      document.getElementById('displayOrders').innerHTML = customerData.orders;
      document.getElementById('displayTier').innerHTML = calculateTier(customerData.points);
      document.getElementById('displayReferral').innerHTML = customerData.referralCode || 'CRM' + Math.floor(Math.random() * 10000);
    }
    
    function calculateTier(points) {
      if (points >= 5000) return 'Diamond';
      if (points >= 3000) return 'Platinum';
      if (points >= 2000) return 'Gold';
      if (points >= 1000) return 'Silver';
      return 'Bronze';
    }
    
    // ------------------------------------------------------
    // 6. ประวัติการสั่งซื้อ
    // ------------------------------------------------------
    function addOrderToHistory(order) {
      const historyDiv = document.getElementById('orderHistory');
      const now = new Date();
      const dateStr = now.toLocaleDateString('th-TH');
      
      historyDiv.innerHTML = `
        <div class="crm-card p-3 text-left">
          <div class="flex justify-between">
            <div>
              <p class="text-white font-medium">${order.productName}</p>
              <p class="text-xs text-gray-400">${dateStr} | ${order.size} | x${order.quantity}</p>
            </div>
            <div class="text-right">
              <p class="text-green-400 text-xs">สำเร็จ</p>
              <p class="text-white font-bold">${order.totalAmount.toLocaleString()}</p>
            </div>
          </div>
        </div>
      `;
    }
    
    // ------------------------------------------------------
    // 7. Date & Time
    // ------------------------------------------------------
    function updateDateTime() {
      const now = new Date();
      document.getElementById('currentDateTime').innerHTML = 
        now.toLocaleDateString('th-TH', { 
          day: 'numeric', month: 'short', year: 'numeric',
          hour: '2-digit', minute: '2-digit' 
        });
    }
    
    // ------------------------------------------------------
    // 8. Notifications
    // ------------------------------------------------------
    function showLoading() {
      Swal.fire({
        title: 'กำลังดำเนินการ',
        html: '<div class="loading-spinner"></div>',
        showConfirmButton: false,
        allowOutsideClick: false,
        background: '#1a1e24',
        color: 'white'
      });
    }
    
    function hideLoading() {
      Swal.close();
    }
    
    function showAlert(message, type = 'info') {
      Swal.fire({
        icon: type,
        title: type === 'success' ? 'สำเร็จ' : type === 'error' ? 'ข้อผิดพลาด' : 'แจ้งเตือน',
        text: message,
        timer: 2000,
        showConfirmButton: false,
        background: '#1a1e24',
        color: 'white'
      });
    }
    
    function showSuccess(points) {
      Swal.fire({
        icon: 'success',
        title: 'สั่งซื้อสำเร็จ!',
        html: `<div class="text-center">
                 <p class="text-gray-300">ได้รับแต้มสะสม</p>
                 <p class="text-3xl font-bold text-blue-400">+${points}</p>
               </div>`,
        timer: 2500,
        showConfirmButton: false,
        background: '#1a1e24',
        color: 'white'
      });
    }
    
    // ------------------------------------------------------
    // 9. Event Listeners
    // ------------------------------------------------------
    document.querySelectorAll('input[name="product"]').forEach(r => {
      r.addEventListener('change', calculateTotal);
    });
    
    document.getElementById('quantity').addEventListener('change', calculateTotal);
    document.getElementById('customerPhone').addEventListener('blur', function() {
      const phone = this.value.replace(/[^0-9]/g, '');
      if (phone.length >= 9) {
        // สามารถเรียกดูประวัติจากเบอร์โทรได้
      }
    });
  </script>
  
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
</html>
