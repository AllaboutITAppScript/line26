<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LINE ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£ ¬∑ ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</title>
    
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- LINE LIFF -->
    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    
    <style>
        * {
            font-family: 'IBM Plex Sans Thai', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #06c755;
            --primary-dark: #05b34a;
            --bg: #0a0a0f;
            --bg-card: #1a1d24;
            --border: #2a2e36;
            --text: #ffffff;
            --text-secondary: #9ca3af;
        }
        
        body {
            background-color: var(--bg);
            color: var(--text);
            padding-bottom: 70px;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(26, 29, 36, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            z-index: 50;
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: var(--text-secondary);
            font-size: 12px;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .nav-item.active {
            color: var(--primary);
        }
        
        .nav-item i {
            font-size: 20px;
        }
        
        .tab-content {
            display: none;
            padding: 16px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Grid Layout - 3 Cards on Desktop */
        .posts-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }
        
        @media (min-width: 768px) {
            .posts-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 1024px) {
            .posts-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        /* News Card */
        .news-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s, border-color 0.2s;
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .news-card:active {
            transform: scale(0.98);
            border-color: var(--primary);
        }
        
        .image-container {
            position: relative;
            width: 100%;
            aspect-ratio: 16/9;
            overflow: hidden;
            background: #2a2e36;
        }
        
        .news-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .news-card:hover .news-image {
            transform: scale(1.05);
        }
        
        .news-content {
            padding: 16px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 500;
            display: inline-block;
        }
        
        .badge-news {
            background: rgba(6,199,85,0.15);
            color: var(--primary);
            border: 1px solid rgba(6,199,85,0.3);
        }
        
        .badge-event {
            background: rgba(245,158,11,0.15);
            color: #f59e0b;
            border: 1px solid rgba(245,158,11,0.3);
        }
        
        .badge-urgent {
            background: rgba(239,68,68,0.15);
            color: #ef4444;
            border: 1px solid rgba(239,68,68,0.3);
        }
        
        /* Share Button */
        .share-button {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
            color: #00B900;
            width: 40px;
            height: 40px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            z-index: 10;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .share-button:active {
            transform: scale(0.95);
            background: rgba(0,0,0,0.8);
        }
        
        .share-button i {
            font-size: 20px;
        }
        
        /* Post Actions (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö) */
        .post-actions {
            position: absolute;
            top: 12px;
            left: 12px;
            display: flex;
            gap: 8px;
            z-index: 10;
        }
        
        .action-btn {
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .action-btn.edit {
            color: #3b82f6;
        }
        
        .action-btn.delete {
            color: #ef4444;
        }
        
        .action-btn:active {
            transform: scale(0.95);
            background: rgba(0,0,0,0.8);
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 24px;
            margin-bottom: 16px;
        }
        
        .page-btn {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            width: 40px;
            height: 40px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .page-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .page-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .page-btn:not(:disabled):active {
            transform: scale(0.95);
        }
        
        /* Swiper Slider */
        .swiper {
            width: 100%;
            aspect-ratio: 16/9;
            margin-bottom: 20px;
            border-radius: 20px;
        }
        
        .swiper-slide {
            border-radius: 20px;
            overflow: hidden;
            position: relative;
        }
        
        .swiper-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .slide-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            color: white;
        }
        
        .slide-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            z-index: 10;
            background: rgba(0,0,0,0.7);
            color: white;
        }
        
        .slide-badge.urgent { background: #ef4444; }
        .slide-badge.event { background: #f59e0b; }
        .slide-badge.news { background: #06c755; }
        
        .btn-primary {
            background: var(--primary);
            color: white;
            padding: 12px;
            border-radius: 12px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        .btn-primary:active {
            opacity: 0.8;
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
            padding: 12px;
            border-radius: 12px;
            font-weight: 600;
            border: none;
            cursor: pointer;
        }
        
        .btn-share {
            background: #00B900;
            color: white;
            padding: 12px;
            border-radius: 30px;
            font-weight: 600;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
        }
        
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(10px);
            z-index: 100;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--bg-card);
            border-radius: 24px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 24px;
        }
        
        .modal-image {
            width: 100%;
            aspect-ratio: 16/9;
            object-fit: cover;
            border-radius: 16px;
            background: #2a2e36;
        }
        
        .loading {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .loading.active {
            display: flex;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .profile-header {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            border: 1px solid var(--border);
            cursor: pointer;
        }
        
        .profile-avatar {
            width: 60px;
            height: 60px;
            border-radius: 30px;
            border: 3px solid var(--primary);
            object-fit: cover;
        }
        
        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            text-align: center;
        }
        
        .search-box {
            position: relative;
            margin-bottom: 16px;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 12px 12px 44px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 30px;
            color: var(--text);
        }
        
        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .search-box i {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }
        
        .filter-container {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 8px;
            margin-bottom: 20px;
        }
        
        .filter-btn {
            padding: 8px 16px;
            border-radius: 30px;
            font-size: 14px;
            white-space: nowrap;
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .toast {
            position: fixed;
            bottom: 80px;
            left: 16px;
            right: 16px;
            background: var(--bg-card);
            border-left: 4px solid var(--primary);
            border-radius: 12px;
            padding: 12px 16px;
            z-index: 1000;
            display: none;
        }
        
        .toast.show {
            display: block;
        }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <!-- Loading -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>
    
    <!-- Toast -->
    <div class="toast" id="toast">
        <p id="toast-message"></p>
    </div>

    <!-- Main Content -->
    <div class="min-h-screen">
        <!-- Tab: Home -->
        <div id="tab-home" class="tab-content active">
            <!-- Profile Header -->
            <div class="profile-header" id="profile-header">
                <img id="profile-avatar" src="" alt="avatar" class="profile-avatar" loading="lazy">
                <div class="flex-1">
                    <h2 id="profile-name" class="text-lg font-bold">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</h2>
                    <p id="profile-email" class="text-sm text-gray-400"></p>
                    <p id="profile-role" class="text-xs text-[#06c755] mt-1"></p>
                </div>
                <i class="fas fa-chevron-down text-gray-400"></i>
            </div>
            
            <!-- Profile Menu -->
            <div id="profile-menu" class="profile-menu hidden">
                <!-- Profile menu items -->
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-3 gap-2 mb-4">
                <div class="stat-card">
                    <p class="text-xs text-gray-400">‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</p>
                    <p id="stat-news" class="text-xl font-bold">-</p>
                </div>
                <div class="stat-card">
                    <p class="text-xs text-gray-400">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p>
                    <p id="stat-events" class="text-xl font-bold">-</p>
                </div>
                <div class="stat-card">
                    <p class="text-xs text-gray-400">‡∏î‡πà‡∏ß‡∏ô</p>
                    <p id="stat-urgent" class="text-xl font-bold">-</p>
                </div>
            </div>

            <!-- Hero Slider -->
            <div class="swiper hero-swiper mb-4">
                <div class="swiper-wrapper" id="hero-slider-wrapper"></div>
                <div class="swiper-pagination"></div>
            </div>

            <!-- Search -->
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£ ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°...">
            </div>

            <!-- Filter -->
            <div class="filter-container">
                <button class="filter-btn active" data-filter="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                <button class="filter-btn" data-filter="news">üì∞ ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</button>
                <button class="filter-btn" data-filter="event">üéâ ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</button>
                <button class="filter-btn" data-filter="urgent">‚ö†Ô∏è ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏î‡πà‡∏ß‡∏ô</button>
            </div>

            <!-- Posts Grid -->
            <div id="posts-grid" class="posts-grid"></div>
            
            <!-- Pagination -->
            <div class="pagination" id="pagination"></div>
        </div>

        <!-- Tab: My Posts -->
        <div id="tab-my" class="tab-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
                <button id="create-post-btn" class="bg-[#06c755] text-white px-4 py-2 rounded-xl text-sm" onclick="showCreatePostModal()">
                    <i class="fas fa-plus mr-1"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á
                </button>
            </div>
            <div id="my-posts-list" class="posts-grid"></div>
        </div>

        <!-- Tab: Notifications -->
        <div id="tab-notifications" class="tab-content">
            <h2 class="text-xl font-bold mb-4">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h2>
            <div id="notifications-list" class="space-y-3"></div>
        </div>

        <!-- Tab: Admin -->
        <div id="tab-admin" class="tab-content">
            <!-- Admin content -->
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-item active" data-tab="home">
            <i class="fas fa-home"></i>
            <span>‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</span>
        </div>
        <div class="nav-item" data-tab="my">
            <i class="fas fa-pen-fancy"></i>
            <span>‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</span>
        </div>
        <div class="nav-item" data-tab="notifications">
            <i class="fas fa-bell"></i>
            <span>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</span>
            <span id="notif-badge" class="absolute -top-1 right-4 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center hidden">0</span>
        </div>
        <div class="nav-item hidden admin-only" data-tab="admin">
            <i class="fas fa-cog"></i>
            <span>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</span>
        </div>
    </div>

    <!-- Post Detail Modal -->
    <div class="modal" id="post-modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modal-title" class="text-xl font-bold"></h3>
                <button onclick="closeModal()"><i class="fas fa-times text-gray-400 text-xl"></i></button>
            </div>
            <div id="modal-body" class="space-y-4"></div>
            <div class="flex gap-2 mt-4">
                <button class="btn-share flex-1" onclick="shareCurrentPost()">
                    <i class="fab fa-line"></i> ‡πÅ‡∏ä‡∏£‡πå
                </button>
                <button class="btn-outline flex-1" onclick="closeModal()">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>

    <!-- Create/Edit Post Modal -->
    <div class="modal" id="create-modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 id="create-modal-title" class="text-xl font-bold">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà</h3>
                <button onclick="closeCreateModal()"><i class="fas fa-times text-gray-400 text-xl"></i></button>
            </div>
            <form id="post-form" onsubmit="savePost(event)">
                <input type="hidden" id="edit-post-id">
                
                <select id="post-type" class="input-field" required>
                    <option value="news">üì∞ ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</option>
                    <option value="event">üéâ ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</option>
                    <option value="urgent">‚ö†Ô∏è ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏î‡πà‡∏ß‡∏ô</option>
                </select>
                
                <input type="text" id="post-title" placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠" class="input-field" required>
                
                <textarea id="post-content" placeholder="‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤" class="input-field" rows="5" required></textarea>
                
                <input type="url" id="post-link" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)" class="input-field">
                
                <div class="upload-area" onclick="document.getElementById('post-image-file').click()">
                    <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                    <p class="text-sm text-gray-400">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</p>
                </div>
                <input type="file" id="post-image-file" accept="image/*" style="display: none" onchange="previewImage(this)">
                <img id="image-preview" class="image-preview" src="">
                <input type="hidden" id="post-image" value="">
                
                <select id="post-status" class="input-field">
                    <option value="published">‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà</option>
                    <option value="draft">‡∏â‡∏ö‡∏±‡∏ö‡∏£‡πà‡∏≤‡∏á</option>
                </select>
                
                <div class="flex gap-2">
                    <button type="submit" class="btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button type="button" class="btn-outline" onclick="closeCreateModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    
    <script>
        // ========== CONFIG ==========
        const CONFIG = {
            GAS_URL: 'https://script.google.com/macros/s/AKfycbwSz6Y_fpvB0qN52eS6QD2RFJD-bJA369B6b86W1ZGVCOrbPXGGbpBIS3hDO8h6awKzkw/exec',
            LIFF_ID: '2008904120-T7I0VPZf',
            PAGE_SIZE: 9, // ‡πÅ‡∏™‡∏î‡∏á 9 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤ (3x3)
            DRIVE_FOLDER_ID: '18V_3SzGvCIfwbRqIpIEwRSVdA88T8mcE'
        };

        // ========== STATE ==========
        const state = {
            user: {
                lineUserId: 'test-user-123',
                displayName: '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö',
                role: 'user'
            },
            posts: [],
            currentFilter: 'all',
            searchTerm: '',
            currentPage: 1,
            totalPages: 1,
            currentPost: null,
            isLoading: false
        };

        // ========== DOM Elements ==========
        const loading = document.getElementById('loading');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');

        // ========== UTILS ==========
        function showLoading() { loading.classList.add('active'); }
        function hideLoading() { loading.classList.remove('active'); }

        function showToast(msg, type = 'success') {
            toastMessage.textContent = msg;
            toast.style.borderLeftColor = type === 'success' ? '#06c755' : '#ef4444';
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function formatDate(dateStr) {
            const d = new Date(dateStr);
            return d.toLocaleDateString('th-TH', { 
                year: 'numeric', month: 'short', day: 'numeric'
            });
        }

        // ========== MOCK DATA ==========
        function generateMockPosts() {
            const types = ['news', 'event', 'urgent'];
            const titles = [
                '‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡∏ß‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà ‡πÅ‡∏ä‡∏£‡πå‡∏Ç‡πà‡∏≤‡∏ß‡∏ú‡πà‡∏≤‡∏ô LINE',
                '‡∏á‡∏≤‡∏ô‡∏°‡∏´‡∏Å‡∏£‡∏£‡∏° LINE FRIENDS 2024',
                '‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏î‡πà‡∏ß‡∏ô! ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á',
                'LINE ‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡∏ß‡∏™‡∏ï‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà',
                '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡πà‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏õ‡∏µ‡πÄ‡∏Å‡πà‡∏≤',
                '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏†‡∏±‡∏¢‡∏°‡∏¥‡∏à‡∏â‡∏≤‡∏ä‡∏µ‡∏û',
                '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢',
                'LINE MAN ‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà',
                '‡∏£‡πà‡∏ß‡∏°‡∏™‡∏ô‡∏∏‡∏Å‡∏ä‡∏¥‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•',
                'LINE TV ‡∏°‡∏µ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡πÉ‡∏´‡∏°‡πà',
                '‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ú‡∏•‡∏ú‡∏π‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ',
                'LINE Wallet ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï'
            ];
            
            const posts = [];
            for (let i = 1; i <= 24; i++) {
                posts.push({
                    postId: `post-${i}`,
                    type: types[Math.floor(Math.random() * types.length)],
                    title: titles[Math.floor(Math.random() * titles.length)] + ` ${i}`,
                    content: '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö',
                    imageUrl: `https://via.placeholder.com/800x450/${Math.floor(Math.random()*16777215).toString(16)}/ffffff?text=Post+${i}`,
                    authorId: i % 3 === 0 ? 'test-user-123' : 'other-user-' + i,
                    authorName: i % 3 === 0 ? '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö' : '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏∑‡πà‡∏ô',
                    createdAt: new Date().toISOString(),
                    viewCount: Math.floor(Math.random() * 1000)
                });
            }
            return posts;
        }

        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ user ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô
        state.posts = generateMockPosts();
        state.totalPages = Math.ceil(state.posts.length / CONFIG.PAGE_SIZE);

        // ========== CHECK OWNERSHIP ==========
        function isPostOwner(post) {
            return post.authorId === state.user?.lineUserId;
        }

        // ========== RENDER FUNCTIONS ==========
        function renderHeroSlider() {
            const wrapper = document.getElementById('hero-slider-wrapper');
            const featured = state.posts.slice(0, 5);
            
            wrapper.innerHTML = featured.map(post => {
                const typeText = {
                    'news': 'üì∞ ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£',
                    'event': 'üéâ ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°',
                    'urgent': '‚ö†Ô∏è ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏î‡πà‡∏ß‡∏ô'
                }[post.type] || post.type;
                
                return `
                    <div class="swiper-slide cursor-pointer" onclick="showPostDetail('${post.postId}')">
                        <img src="${post.imageUrl}" loading="lazy">
                        <span class="slide-badge ${post.type}">${typeText}</span>
                        <div class="slide-content">
                            <h3 class="font-bold text-lg line-clamp-2">${post.title}</h3>
                            <p class="text-xs text-gray-300 mt-1">${formatDate(post.createdAt)}</p>
                        </div>
                    </div>
                `;
            }).join('');

            new Swiper('.hero-swiper', {
                autoplay: { delay: 3000 },
                pagination: { el: '.swiper-pagination', clickable: true },
                loop: true
            });
        }

        function renderPosts() {
            const grid = document.getElementById('posts-grid');
            
            // ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏° filter ‡πÅ‡∏•‡∏∞ search
            let filtered = state.posts;
            if (state.currentFilter !== 'all') {
                filtered = filtered.filter(p => p.type === state.currentFilter);
            }
            if (state.searchTerm) {
                filtered = filtered.filter(p => 
                    p.title.toLowerCase().includes(state.searchTerm.toLowerCase())
                );
            }
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì pagination
            state.totalPages = Math.ceil(filtered.length / CONFIG.PAGE_SIZE);
            const start = (state.currentPage - 1) * CONFIG.PAGE_SIZE;
            const paginatedPosts = filtered.slice(start, start + CONFIG.PAGE_SIZE);
            
            if (paginatedPosts.length === 0) {
                grid.innerHTML = '<div class="col-span-full text-center py-12 text-gray-400">‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå</div>';
                renderPagination(0);
                return;
            }

            grid.innerHTML = paginatedPosts.map(post => {
                const typeClass = {
                    'news': 'badge-news',
                    'event': 'badge-event',
                    'urgent': 'badge-urgent'
                }[post.type];
                
                const typeText = {
                    'news': 'üì∞ ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£',
                    'event': 'üéâ ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°',
                    'urgent': '‚ö†Ô∏è ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏î‡πà‡∏ß‡∏ô'
                }[post.type];
                
                const isOwner = isPostOwner(post);
                
                return `
                    <div class="news-card">
                        ${isOwner ? `
                            <div class="post-actions">
                                <button class="action-btn edit" onclick="event.stopPropagation(); editPost('${post.postId}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete" onclick="event.stopPropagation(); deletePost('${post.postId}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        ` : ''}
                        <button class="share-button" onclick="event.stopPropagation(); sharePost('${post.postId}')">
                            <i class="fab fa-line"></i>
                        </button>
                        <div class="image-container" onclick="showPostDetail('${post.postId}')">
                            <img src="${post.imageUrl}" class="news-image" loading="lazy">
                        </div>
                        <div class="news-content" onclick="showPostDetail('${post.postId}')">
                            <div class="flex justify-between items-start mb-2">
                                <span class="badge ${typeClass}">${typeText}</span>
                                <span class="text-xs text-gray-500">${formatDate(post.createdAt)}</span>
                            </div>
                            <h3 class="font-semibold text-base mb-2 line-clamp-2">${post.title}</h3>
                            <p class="text-sm text-gray-400 line-clamp-2 flex-1">${post.content}</p>
                            <div class="flex items-center justify-between mt-3 text-xs text-gray-500">
                                <span><i class="fas fa-user mr-1"></i> ${post.authorName}</span>
                                <span><i class="fas fa-eye mr-1"></i> ${post.viewCount}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            renderPagination(filtered.length);
        }

        function renderPagination(totalItems) {
            const pagination = document.getElementById('pagination');
            if (totalItems <= CONFIG.PAGE_SIZE) {
                pagination.innerHTML = '';
                return;
            }

            let html = '';
            
            // Prev button
            html += `<button class="page-btn" onclick="changePage(${state.currentPage - 1})" ${state.currentPage === 1 ? 'disabled' : ''}>
                <i class="fas fa-chevron-left"></i>
            </button>`;
            
            // Page numbers
            for (let i = 1; i <= state.totalPages; i++) {
                if (i === 1 || i === state.totalPages || (i >= state.currentPage - 1 && i <= state.currentPage + 1)) {
                    html += `<button class="page-btn ${i === state.currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
                } else if (i === state.currentPage - 2 || i === state.currentPage + 2) {
                    html += `<span class="text-gray-500">...</span>`;
                }
            }
            
            // Next button
            html += `<button class="page-btn" onclick="changePage(${state.currentPage + 1})" ${state.currentPage === state.totalPages ? 'disabled' : ''}>
                <i class="fas fa-chevron-right"></i>
            </button>`;
            
            pagination.innerHTML = html;
        }

        function changePage(page) {
            state.currentPage = page;
            renderPosts();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ========== POST DETAIL ==========
        function showPostDetail(postId) {
            const post = state.posts.find(p => p.postId === postId);
            if (!post) return;

            state.currentPost = post;

            document.getElementById('modal-title').textContent = post.title;

            const typeText = {
                'news': 'üì∞ ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£',
                'event': 'üéâ ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°',
                'urgent': '‚ö†Ô∏è ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏î‡πà‡∏ß‡∏ô'
            }[post.type];

            const html = `
                <img src="${post.imageUrl}" class="modal-image" loading="lazy">
                
                <div class="flex justify-between items-center">
                    <span class="badge badge-${post.type}">${typeText}</span>
                    <span class="text-sm text-gray-400">
                        <i class="fas fa-eye mr-1"></i>${post.viewCount}
                    </span>
                </div>
                
                <p class="text-gray-400 whitespace-pre-wrap">${post.content}</p>
                
                <div class="text-sm text-gray-500 border-t border-[#2a2e36] pt-4">
                    <p><i class="fas fa-user mr-2"></i> ‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÇ‡∏î‡∏¢: ${post.authorName}</p>
                    <p><i class="fas fa-calendar mr-2 mt-2"></i> ${formatDate(post.createdAt)}</p>
                </div>
            `;

            document.getElementById('modal-body').innerHTML = html;
            document.getElementById('post-modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('post-modal').classList.remove('active');
        }

        // ========== SHARE FUNCTION ==========
        async function sharePost(postId) {
            const post = state.posts.find(p => p.postId === postId);
            if (!post) return;

            showLoading();

            try {
                const typeText = {
                    'news': 'üì∞ ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£',
                    'event': 'üéâ ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°',
                    'urgent': '‚ö†Ô∏è ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏î‡πà‡∏ß‡∏ô'
                }[post.type];

                const flexMessage = {
                    type: 'flex',
                    altText: post.title,
                    contents: {
                        type: 'bubble',
                        hero: {
                            type: 'image',
                            url: post.imageUrl,
                            size: 'full',
                            aspectRatio: '16:9',
                            aspectMode: 'cover'
                        },
                        body: {
                            type: 'box',
                            layout: 'vertical',
                            spacing: 'md',
                            contents: [
                                {
                                    type: 'text',
                                    text: post.title,
                                    weight: 'bold',
                                    size: 'lg',
                                    wrap: true
                                },
                                {
                                    type: 'text',
                                    text: typeText,
                                    size: 'xs',
                                    color: '#06c755',
                                    weight: 'bold'
                                },
                                {
                                    type: 'text',
                                    text: post.content.length > 100 ? post.content.substring(0, 100) + '...' : post.content,
                                    wrap: true,
                                    color: '#8c8c8c',
                                    size: 'sm',
                                    maxLines: 3
                                }
                            ]
                        },
                        footer: {
                            type: 'box',
                            layout: 'vertical',
                            contents: [
                                {
                                    type: 'button',
                                    style: 'primary',
                                    color: '#06c755',
                                    action: {
                                        type: 'uri',
                                        label: '‡∏≠‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠',
                                        uri: `https://line.me/R/app/${CONFIG.LIFF_ID}`
                                    }
                                }
                            ]
                        }
                    }
                };

                await liff.shareTargetPicker([flexMessage]);
                showToast('‚úÖ ‡πÅ‡∏ä‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            } catch (err) {
                console.error(err);
                showToast('‚ùå ‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'error');
            } finally {
                hideLoading();
            }
        }

        function shareCurrentPost() {
            if (state.currentPost) {
                sharePost(state.currentPost.postId);
            }
        }

        // ========== POST CRUD ==========
        function showCreatePostModal() {
            document.getElementById('create-modal-title').textContent = '‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà';
            document.getElementById('edit-post-id').value = '';
            document.getElementById('post-form').reset();
            document.getElementById('image-preview').style.display = 'none';
            document.getElementById('create-modal').classList.add('active');
        }

        function closeCreateModal() {
            document.getElementById('create-modal').classList.remove('active');
        }

        function editPost(postId) {
            const post = state.posts.find(p => p.postId === postId);
            if (!post || !isPostOwner(post)) {
                showToast('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ô‡∏µ‡πâ', 'error');
                return;
            }

            document.getElementById('create-modal-title').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏û‡∏™‡∏ï‡πå';
            document.getElementById('edit-post-id').value = post.postId;
            document.getElementById('post-type').value = post.type;
            document.getElementById('post-title').value = post.title;
            document.getElementById('post-content').value = post.content;
            document.getElementById('post-image').value = post.imageUrl;
            document.getElementById('post-link').value = post.link || '';
            
            document.getElementById('create-modal').classList.add('active');
        }

        function deletePost(postId) {
            const post = state.posts.find(p => p.postId === postId);
            if (!post || !isPostOwner(post)) {
                showToast('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏•‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ô‡∏µ‡πâ', 'error');
                return;
            }

            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                state.posts = state.posts.filter(p => p.postId !== postId);
                showToast('‚úÖ ‡∏•‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                renderPosts();
                renderHeroSlider();
            }
        }

        async function savePost(e) {
            e.preventDefault();
            
            const id = document.getElementById('edit-post-id').value;
            const postData = {
                postId: id || 'post-' + Date.now(),
                type: document.getElementById('post-type').value,
                title: document.getElementById('post-title').value,
                content: document.getElementById('post-content').value,
                imageUrl: document.getElementById('post-image').value || 'https://via.placeholder.com/800x450/2a2e36/ffffff?text=LINE',
                link: document.getElementById('post-link').value,
                authorId: state.user.lineUserId,
                authorName: state.user.displayName,
                createdAt: new Date().toISOString(),
                viewCount: 0
            };

            if (id) {
                // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                const index = state.posts.findIndex(p => p.postId === id);
                if (index !== -1) {
                    state.posts[index] = { ...state.posts[index], ...postData };
                }
                showToast('‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            } else {
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
                state.posts.unshift(postData);
                showToast('‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            }

            closeCreateModal();
            renderPosts();
            renderHeroSlider();
        }

        // ========== FILTER & SEARCH ==========
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                state.currentFilter = btn.dataset.filter;
                state.currentPage = 1;
                renderPosts();
            });
        });

        let searchTimeout;
        document.getElementById('search-input').addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                state.searchTerm = e.target.value;
                state.currentPage = 1;
                renderPosts();
            }, 500);
        });

        // ========== TAB NAVIGATION ==========
        document.querySelectorAll('.nav-item').forEach(tab => {
            tab.addEventListener('click', () => {
                const target = tab.dataset.tab;
                
                document.querySelectorAll('.nav-item').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                document.getElementById(`tab-${target}`).classList.add('active');
                
                if (target === 'home') {
                    renderPosts();
                    renderHeroSlider();
                }
                if (target === 'my') {
                    // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
                    const myPosts = state.posts.filter(p => isPostOwner(p));
                    // TODO: render my posts
                }
            });
        });

        // ========== PROFILE MENU ==========
        document.getElementById('profile-header').addEventListener('click', () => {
            // Toggle profile menu
        });

        // ========== INIT ==========
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('profile-name').textContent = state.user.displayName;
            document.getElementById('profile-avatar').src = 'https://via.placeholder.com/100/06c755/ffffff?text=USER';
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
            document.getElementById('stat-news').textContent = state.posts.filter(p => p.type === 'news').length;
            document.getElementById('stat-events').textContent = state.posts.filter(p => p.type === 'event').length;
            document.getElementById('stat-urgent').textContent = state.posts.filter(p => p.type === 'urgent').length;
            
            renderHeroSlider();
            renderPosts();
        });

        window.onclick = function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        };
    </script>
</body>
</html>
