<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>‚ö° SIMPLE CRM 2026</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Font Prompt -->
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- SweetAlert2 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" />
  
  <!-- LIFF v2 -->
  <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
  
  <!-- Font Awesome 6 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  
  <style>
    * {
      font-family: 'Prompt', sans-serif;
    }
    
    body {
      background: linear-gradient(145deg, #0a0c10 0%, #1a1e24 100%);
      color: #ffffff;
    }
    
    /* Simple CRM Glassmorphism */
    .crm-glass {
      background: rgba(18, 22, 28, 0.85);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 24px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    }
    
    .crm-card {
      background: rgba(26, 32, 39, 0.9);
      border: 1px solid rgba(74, 144, 226, 0.2);
      border-radius: 20px;
      transition: all 0.3s ease;
    }
    
    .crm-card:hover {
      border-color: #4a90e2;
      transform: translateY(-2px);
    }
    
    .crm-input {
      background: rgba(15, 20, 25, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 12px 20px;
      color: white;
      transition: all 0.3s ease;
      width: 100%;
    }
    
    .crm-input:focus {
      border-color: #4a90e2;
      box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
      outline: none;
      background: rgba(20, 28, 36, 0.95);
    }
    
    .crm-input::placeholder {
      color: rgba(200, 200, 220, 0.5);
    }
    
    .crm-btn {
      background: linear-gradient(145deg, #4a90e2, #357abd);
      border-radius: 16px;
      padding: 14px 28px;
      color: white;
      font-weight: 600;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
    }
    
    .crm-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(74, 144, 226, 0.3);
    }
    
    .crm-badge {
      background: rgba(74, 144, 226, 0.15);
      border: 1px solid #4a90e2;
      border-radius: 30px;
      padding: 4px 16px;
      display: inline-flex;
      align-items: center;
      color: #a0d0ff;
    }
    
    .profile-avatar {
      width: 80px;
      height: 80px;
      border-radius: 20px;
      border: 3px solid #4a90e2;
      object-fit: cover;
    }
    
    .loading-spinner {
      border: 3px solid rgba(255,255,255,0.1);
      border-radius: 50%;
      border-top: 3px solid #4a90e2;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Simple CRM Timeline */
    .crm-timeline {
      position: relative;
      padding-left: 24px;
    }
    
    .crm-timeline::before {
      content: '';
      position: absolute;
      left: 7px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: linear-gradient(to bottom, #4a90e2, #9b59b6);
    }
    
    .timeline-item {
      position: relative;
      margin-bottom: 16px;
    }
    
    .timeline-dot {
      position: absolute;
      left: -20px;
      top: 8px;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #4a90e2;
      border: 2px solid rgba(255,255,255,0.3);
    }
  </style>
</head>
<body class="min-h-screen p-4 lg:p-6">
  
  <!-- Main Container -->
  <div class="max-w-6xl mx-auto">
    
    <!-- Header - Simple CRM -->
    <div class="crm-glass p-6 mb-6 flex flex-col lg:flex-row items-center justify-between">
      <div class="flex items-center space-x-4">
        <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
          <i class="fas fa-users text-2xl text-white"></i>
        </div>
        <div>
          <h1 class="text-2xl lg:text-3xl font-bold text-white">
            SIMPLE CRM 2026
          </h1>
          <p class="text-blue-300 text-sm flex items-center mt-1">
            <i class="fas fa-check-circle mr-2"></i>
            ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
          </p>
        </div>
      </div>
      
      <!-- Connection Status -->
      <div class="flex items-center space-x-3 mt-4 lg:mt-0">
        <div class="crm-badge">
          <i class="fas fa-circle text-green-400 text-xs mr-2"></i>
          <span id="connectionStatus">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</span>
        </div>
        <div class="text-sm text-gray-400" id="currentDateTime"></div>
      </div>
    </div>
    
    <!-- Main Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      
      <!-- ========== LEFT COLUMN - CUSTOMER PROFILE ========== -->
      <div class="lg:col-span-1 space-y-6">
        
        <!-- Profile Card -->
        <div class="crm-glass p-6">
          <div class="flex flex-col items-center text-center">
            
            <!-- Profile Image -->
            <div class="relative mb-4">
              <img id="profilePicture" class="profile-avatar" 
                   src="https://via.placeholder.com/80/1e1e2e/4a90e2?text=CRM" 
                   alt="Profile">
              <div class="absolute -bottom-1 -right-1 w-5 h-5 bg-green-500 rounded-full border-2 border-gray-900"></div>
            </div>
            
            <!-- Customer Name -->
            <h2 id="userName" class="text-xl font-bold text-white mb-1">
              ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
            </h2>
            
            <!-- Customer Tier -->
            <div id="userTierBadge" class="crm-badge mb-3">
              <i class="fas fa-star text-yellow-400 mr-2"></i>
              <span id="userTier">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</span>
            </div>
            
            <!-- Quick Stats -->
            <div class="grid grid-cols-2 gap-3 w-full mt-2">
              <div class="crm-card p-3">
                <p class="text-xs text-gray-400">‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°</p>
                <p class="text-xl font-bold text-white" id="userPoints">0</p>
              </div>
              <div class="crm-card p-3">
                <p class="text-xs text-gray-400">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</p>
                <p class="text-xl font-bold text-white" id="userOrders">0</p>
              </div>
            </div>
            
            <!-- Referral Code -->
            <div class="w-full mt-4 p-4 crm-card">
              <p class="text-xs text-gray-400 mb-2 flex items-center">
                <i class="fas fa-gift text-blue-400 mr-2"></i>
                ‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô
              </p>
              <div class="flex items-center justify-between bg-black/30 rounded-xl p-2">
                <code id="userReferralCode" class="text-blue-300 text-sm font-mono">CRM-XXXX-2026</code>
                <button onclick="copyReferralCode()" class="text-blue-400 hover:text-blue-300 px-2">
                  <i class="fas fa-copy"></i>
                </button>
              </div>
            </div>
            
            <!-- LINE Login Button (‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà login) -->
            <div id="loginSection" class="w-full mt-4">
              <button id="lineLoginBtn" onclick="handleLineLogin()" 
                      class="crm-btn w-full flex items-center justify-center space-x-2">
                <i class="fab fa-line text-xl"></i>
                <span>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ LINE</span>
              </button>
            </div>
            
            <!-- Customer Info (‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠ login ‡πÅ‡∏•‡πâ‡∏ß) -->
            <div id="customerInfoSection" class="w-full mt-4 hidden">
              <div class="crm-card p-4 text-left">
                <div class="flex items-center space-x-2 mb-2">
                  <i class="fas fa-envelope text-blue-400"></i>
                  <span id="userEmailDisplay" class="text-sm text-gray-300">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏µ‡πÄ‡∏°‡∏•</span>
                </div>
                <div class="flex items-center space-x-2">
                  <i class="fas fa-calendar text-blue-400"></i>
                  <span id="userSince" class="text-sm text-gray-300">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà: 2026</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="crm-glass p-6">
          <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
            <i class="fas fa-bolt text-blue-400 mr-2"></i>
            ‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πà‡∏ß‡∏ô
          </h3>
          <div class="space-y-3">
            <button onclick="openChat()" class="w-full crm-card p-3 flex items-center space-x-3 hover:border-blue-500">
              <div class="w-10 h-10 bg-blue-500/20 rounded-xl flex items-center justify-center">
                <i class="fas fa-headset text-blue-400"></i>
              </div>
              <span class="text-white">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</span>
            </button>
            <button onclick="checkPoints()" class="w-full crm-card p-3 flex items-center space-x-3 hover:border-blue-500">
              <div class="w-10 h-10 bg-green-500/20 rounded-xl flex items-center justify-center">
                <i class="fas fa-coins text-green-400"></i>
              </div>
              <span class="text-white">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏ï‡πâ‡∏°</span>
            </button>
            <button onclick="viewHistory()" class="w-full crm-card p-3 flex items-center space-x-3 hover:border-blue-500">
              <div class="w-10 h-10 bg-purple-500/20 rounded-xl flex items-center justify-center">
                <i class="fas fa-history text-purple-400"></i>
              </div>
              <span class="text-white">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</span>
            </button>
          </div>
        </div>
      </div>
      
      <!-- ========== RIGHT COLUMN - ORDER FORM ========== -->
      <div class="lg:col-span-2 space-y-6">
        
        <!-- Order Form Card -->
        <div class="crm-glass p-6">
          <h2 class="text-xl font-bold text-white mb-6 flex items-center">
            <i class="fas fa-shopping-cart text-blue-400 mr-3"></i>
            ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
            <span class="ml-auto text-sm font-normal text-gray-400" id="formStatus"></span>
          </h2>
          
          <form id="orderForm" onsubmit="handleOrderSubmit(event)" class="space-y-6">
            
            <!-- Product Selection -->
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-3">
                <i class="fas fa-tag text-blue-400 mr-2"></i>
                ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à
              </label>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                
                <!-- Premium Package -->
                <label class="crm-card p-4 cursor-pointer relative border-2 border-transparent hover:border-blue-500 transition-all">
                  <input type="radio" name="product" value="premium" class="hidden peer" onchange="updatePoints()">
                  <div class="flex items-start space-x-3">
                    <div class="w-12 h-12 bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-xl flex items-center justify-center">
                      <i class="fas fa-crown text-white text-xl"></i>
                    </div>
                    <div class="flex-1">
                      <p class="font-bold text-white">Premium Set</p>
                      <p class="text-xs text-gray-400">‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πâ‡∏° 400</p>
                      <p class="text-lg font-bold text-blue-400 mt-1">3,990</p>
                    </div>
                  </div>
                  <span class="absolute top-3 right-3 w-4 h-4 rounded-full border-2 border-blue-400 peer-checked:bg-blue-500"></span>
                </label>
                
                <!-- Standard Package -->
                <label class="crm-card p-4 cursor-pointer relative border-2 border-transparent hover:border-blue-500 transition-all">
                  <input type="radio" name="product" value="standard" class="hidden peer" checked onchange="updatePoints()">
                  <div class="flex items-start space-x-3">
                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center">
                      <i class="fas fa-box text-white text-xl"></i>
                    </div>
                    <div class="flex-1">
                      <p class="font-bold text-white">Standard Set</p>
                      <p class="text-xs text-gray-400">‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πâ‡∏° 250</p>
                      <p class="text-lg font-bold text-blue-400 mt-1">2,490</p>
                    </div>
                  </div>
                  <span class="absolute top-3 right-3 w-4 h-4 rounded-full border-2 border-blue-400 peer-checked:bg-blue-500"></span>
                </label>
              </div>
            </div>
            
            <!-- Size Selection -->
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-3">
                <i class="fas fa-ruler text-blue-400 mr-2"></i>
                ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î
              </label>
              <div class="flex flex-wrap gap-3">
                <button type="button" onclick="selectSize('S')" class="size-btn px-6 py-3 crm-card hover:border-blue-500 transition-all" data-size="S">
                  S <span class="text-xs text-gray-400 ml-1">34-36</span>
                </button>
                <button type="button" onclick="selectSize('M')" class="size-btn px-6 py-3 crm-card hover:border-blue-500 transition-all" data-size="M">
                  M <span class="text-xs text-gray-400 ml-1">38-40</span>
                </button>
                <button type="button" onclick="selectSize('L')" class="size-btn px-6 py-3 crm-card hover:border-blue-500 transition-all" data-size="L">
                  L <span class="text-xs text-gray-400 ml-1">42-44</span>
                </button>
                <button type="button" onclick="selectSize('XL')" class="size-btn px-6 py-3 crm-card hover:border-blue-500 transition-all" data-size="XL">
                  XL <span class="text-xs text-gray-400 ml-1">46-48</span>
                </button>
              </div>
              <input type="hidden" name="size" id="selectedSize" required>
            </div>
            
            <!-- Quantity -->
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-3">
                <i class="fas fa-cubes text-blue-400 mr-2"></i>
                ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
              </label>
              <div class="flex items-center space-x-4">
                <button type="button" onclick="decreaseQuantity()" class="w-12 h-12 crm-card flex items-center justify-center hover:border-blue-500">
                  <i class="fas fa-minus text-blue-400"></i>
                </button>
                <input type="number" name="quantity" id="quantity" value="1" min="1" max="10" 
                       class="w-20 text-center crm-input" onchange="updatePoints()">
                <button type="button" onclick="increaseQuantity()" class="w-12 h-12 crm-card flex items-center justify-center hover:border-blue-500">
                  <i class="fas fa-plus text-blue-400"></i>
                </button>
              </div>
            </div>
            
            <!-- Customer Information -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">
                  <i class="fas fa-phone-alt text-blue-400 mr-2"></i>
                  ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå <span class="text-red-400">*</span>
                </label>
                <div class="relative">
                  <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-blue-400">+66</span>
                  <input type="tel" id="phone" name="phone" placeholder="81 234 5678" 
                         class="crm-input pl-16" required
                         oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">
                  <i class="fas fa-envelope text-blue-400 mr-2"></i>
                  ‡∏≠‡∏µ‡πÄ‡∏°‡∏• <span class="text-red-400">*</span>
                </label>
                <input type="email" id="email" name="email" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•" 
                       class="crm-input" required>
              </div>
            </div>
            
            <!-- Address -->
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                <i class="fas fa-map-marker-alt text-blue-400 mr-2"></i>
                ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á <span class="text-red-400">*</span>
              </label>
              <textarea name="address" id="address" rows="3" 
                        placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•, ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà, ‡∏ñ‡∏ô‡∏ô, ‡πÅ‡∏Ç‡∏ß‡∏á/‡πÄ‡∏Ç‡∏ï, ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î, ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå"
                        class="crm-input" required></textarea>
            </div>
            
            <!-- Referral Code -->
            <div class="crm-card p-4">
              <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-green-500/20 rounded-xl flex items-center justify-center">
                  <i class="fas fa-tag text-green-400"></i>
                </div>
                <div class="flex-1">
                  <p class="text-sm text-gray-400">‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</p>
                  <div class="flex items-center space-x-2">
                    <input type="text" id="referralCode" name="referralCode" 
                           placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô" 
                           class="bg-transparent border-b border-gray-600 px-2 py-1 text-white focus:border-green-500 outline-none w-full">
                    <button type="button" onclick="applyReferral()" class="text-green-400 hover:text-green-300">
                      <i class="fas fa-check-circle text-xl"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Points Summary -->
            <div class="grid grid-cols-2 gap-4">
              <div class="crm-card p-4">
                <p class="text-sm text-gray-400">‡πÅ‡∏ï‡πâ‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</p>
                <p class="text-2xl font-bold text-green-400" id="earnPoints">250</p>
              </div>
              <div class="crm-card p-4">
                <p class="text-sm text-gray-400">‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞</p>
                <p class="text-2xl font-bold text-white" id="totalAmount">2,490</p>
              </div>
            </div>
            
            <!-- Submit Button -->
            <button type="submit" id="submitBtn" 
                    class="crm-btn w-full py-4 text-lg flex items-center justify-center space-x-3">
              <i class="fas fa-check-circle text-xl"></i>
              <span>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</span>
            </button>
            
            <p class="text-xs text-center text-gray-500 mt-4">
              <i class="fas fa-shield-alt text-blue-400 mr-1"></i>
              ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö
            </p>
          </form>
        </div>
        
        <!-- Order History Preview -->
        <div class="crm-glass p-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-white flex items-center">
              <i class="fas fa-history text-blue-400 mr-2"></i>
              ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            </h3>
            <button onclick="viewAllHistory()" class="text-sm text-blue-400 hover:text-blue-300">
              ‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <i class="fas fa-arrow-right ml-1"></i>
            </button>
          </div>
          
          <div id="orderHistoryList" class="crm-timeline">
            <!-- Dynamic order history will be inserted here -->
            <div class="timeline-item">
              <span class="timeline-dot"></span>
              <div class="crm-card p-3">
                <p class="text-gray-400 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Footer -->
    <div class="crm-glass p-4 mt-6 text-center">
      <p class="text-sm text-gray-400">
        ¬© 2026 SIMPLE CRM - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
      </p>
    </div>
  </div>
  
  <script>
    // ============================================
    // SIMPLE CRM 2026 - EASY TO USE
    // ============================================
    
    // Global Variables
    let currentUser = {
      isLoggedIn: false,
      userId: null,
      displayName: null,
      pictureUrl: null,
      points: 0,
      tier: '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ',
      orders: 0,
      referralCode: null
    };
    
    let selectedSize = null;
    let appUrl = 'https://script.google.com/macros/s/AKfycbwVTSyuCYdJP11mKPKd7wWfng-TBS-tXvWliJUzDuHDQjpdwRDGF-n80Qql0Om1zmg6/exec';
    
    // ========== INITIALIZATION ==========
    document.addEventListener('DOMContentLoaded', function() {
      initCRM();
    });
    
    async function initCRM() {
      updateDateTime();
      setInterval(updateDateTime, 1000);
      
      // Check if LIFF is available
      if (typeof liff !== 'undefined') {
        await initLIFF();
      } else {
        showNotification('LINE SDK ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', 'warning');
      }
      
      // Load saved data
      loadCustomerData();
    }
    
    // ========== LIFF FUNCTIONS ==========
    async function initLIFF() {
      try {
        await liff.init({ liffId: '2008904120-EG1o4Gys' });
        updateConnectionStatus('connected');
        
        if (liff.isLoggedIn()) {
          await loadLineProfile();
        } else {
          showLoginButton();
        }
      } catch (error) {
        console.error('LIFF Init Error:', error);
        updateConnectionStatus('error');
        showManualLoginOption();
      }
    }
    
    async function loadLineProfile() {
      try {
        const profile = await liff.getProfile();
        
        currentUser = {
          ...currentUser,
          isLoggedIn: true,
          userId: profile.userId,
          displayName: profile.displayName,
          pictureUrl: profile.pictureUrl,
        };
        
        // Update UI
        document.getElementById('profilePicture').src = profile.pictureUrl || 'https://via.placeholder.com/80/1e1e2e/4a90e2?text=' + profile.displayName.charAt(0);
        document.getElementById('userName').textContent = profile.displayName;
        
        // Try to get email
        await getLineEmail();
        
        // Hide login, show customer info
        document.getElementById('loginSection').classList.add('hidden');
        document.getElementById('customerInfoSection').classList.remove('hidden');
        
        // Generate referral code
        generateReferralCode();
        
        // Load customer data from server
        await fetchCustomerData(profile.userId);
        
      } catch (error) {
        console.error('Profile Error:', error);
        showManualLoginOption();
      }
    }
    
    async function getLineEmail() {
      try {
        if (liff.getDecodedIDToken() && liff.getDecodedIDToken().email) {
          const email = liff.getDecodedIDToken().email;
          document.getElementById('email').value = email;
          document.getElementById('userEmailDisplay').textContent = email;
          currentUser.email = email;
        } else {
          // Request email permission
          const email = await requestEmailPermission();
          if (email) {
            document.getElementById('email').value = email;
            document.getElementById('userEmailDisplay').textContent = email;
            currentUser.email = email;
          }
        }
      } catch (error) {
        console.log('Email not available');
      }
    }
    
    async function requestEmailPermission() {
      try {
        const permission = await liff.permission.request('email');
        if (permission.state === 'granted') {
          const profile = await liff.getProfile();
          return profile.email;
        }
      } catch (error) {
        console.log('Email permission denied');
      }
      return null;
    }
    
    // ========== CRM FUNCTIONS ==========
    async function fetchCustomerData(userId) {
      // In production, fetch from Google Sheets
      // For demo, use mock data
      setTimeout(() => {
        currentUser.points = 1250;
        currentUser.orders = 12;
        currentUser.tier = 'Gold';
        
        updateCRMDisplay();
        loadMockOrderHistory();
      }, 500);
    }
    
    function updateCRMDisplay() {
      document.getElementById('userPoints').textContent = currentUser.points.toLocaleString();
      document.getElementById('userOrders').textContent = currentUser.orders;
      document.getElementById('userTier').textContent = `‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ${currentUser.tier}`;
      document.getElementById('userSince').textContent = `‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà: 2026`;
    }
    
    function generateReferralCode() {
      if (!currentUser.referralCode) {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        let code = 'CRM-';
        for (let i = 0; i < 4; i++) {
          code += chars[Math.floor(Math.random() * chars.length)];
        }
        code += '-2026';
        currentUser.referralCode = code;
      }
      document.getElementById('userReferralCode').textContent = currentUser.referralCode;
    }
    
    // ========== UI FUNCTIONS ==========
    function selectSize(size) {
      selectedSize = size;
      document.getElementById('selectedSize').value = size;
      
      // Update UI
      document.querySelectorAll('.size-btn').forEach(btn => {
        btn.classList.remove('border-blue-500', 'bg-blue-500/20');
      });
      event.currentTarget.classList.add('border-blue-500', 'bg-blue-500/20');
    }
    
    function decreaseQuantity() {
      const qty = document.getElementById('quantity');
      if (parseInt(qty.value) > 1) {
        qty.value = parseInt(qty.value) - 1;
        updatePoints();
      }
    }
    
    function increaseQuantity() {
      const qty = document.getElementById('quantity');
      if (parseInt(qty.value) < 10) {
        qty.value = parseInt(qty.value) + 1;
        updatePoints();
      }
    }
    
    function updatePoints() {
      const product = document.querySelector('input[name="product"]:checked')?.value || 'standard';
      const quantity = parseInt(document.getElementById('quantity').value) || 1;
      const price = product === 'premium' ? 3990 : 2490;
      const points = product === 'premium' ? 400 : 250;
      
      const totalPoints = points * quantity;
      const totalAmount = price * quantity;
      
      document.getElementById('earnPoints').textContent = totalPoints;
      document.getElementById('totalAmount').textContent = totalAmount.toLocaleString();
    }
    
    // ========== ORDER HANDLING ==========
    async function handleOrderSubmit(e) {
      e.preventDefault();
      
      // Validate
      if (!selectedSize) {
        showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', 'warning');
        return;
      }
      
      const phone = document.getElementById('phone').value.replace(/[^0-9]/g, '');
      if (!phone || phone.length < 9) {
        showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'warning');
        return;
      }
      
      const email = document.getElementById('email').value;
      if (!email || !email.includes('@')) {
        showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'warning');
        return;
      }
      
      const address = document.getElementById('address').value;
      if (!address || address.length < 10) {
        showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á', 'warning');
        return;
      }
      
      showLoading();
      
      // Prepare order data
      const product = document.querySelector('input[name="product"]:checked')?.value || 'standard';
      const quantity = parseInt(document.getElementById('quantity').value);
      const pointsEarned = (product === 'premium' ? 400 : 250) * quantity;
      
      const orderData = {
        // Required Fields
        customerId: currentUser.userId || 'GUEST-' + Date.now(),
        customerName: currentUser.displayName || document.getElementById('userName').textContent,
        customerEmail: email,
        customerPhone: '+66' + phone,
        customerTier: currentUser.tier,
        
        // Order Details
        orderId: 'ORD-' + Date.now(),
        timestamp: new Date().toISOString(),
        product: product,
        productName: product === 'premium' ? 'Premium Set' : 'Standard Set',
        size: selectedSize,
        quantity: quantity,
        price: product === 'premium' ? 3990 : 2490,
        totalAmount: (product === 'premium' ? 3990 : 2490) * quantity,
        
        // Points
        pointsEarned: pointsEarned,
        currentPoints: currentUser.points,
        
        // Delivery
        address: address,
        
        // Referral
        referralCode: document.getElementById('referralCode').value || '',
        
        // System
        campaignVersion: 'SIMPLE-CRM-2026',
        source: 'WEB_FORM'
      };
      
      try {
        // Send to Google Sheets
        const response = await fetch(appUrl, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(orderData)
        });
        
        // Update points
        currentUser.points += pointsEarned;
        currentUser.orders += 1;
        updateCRMDisplay();
        
        // Show success
        showSuccess(pointsEarned);
        
        // Clear form
        document.getElementById('orderForm').reset();
        selectedSize = null;
        document.getElementById('selectedSize').value = '';
        document.querySelectorAll('.size-btn').forEach(btn => {
          btn.classList.remove('border-blue-500', 'bg-blue-500/20');
        });
        
        // Send LINE message if logged in
        if (currentUser.isLoggedIn) {
          sendLineConfirmation(orderData);
        }
        
      } catch (error) {
        console.error('Submit Error:', error);
        showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
      } finally {
        hideLoading();
      }
    }
    
    function sendLineConfirmation(data) {
      if (!liff || !liff.isInClient()) return;
      
      const message = {
        type: 'text',
        text: `‚úÖ ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n` +
              `‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà: ${data.orderId}\n` +
              `‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ${data.productName}\n` +
              `‡∏Ç‡∏ô‡∏≤‡∏î: ${data.size} | ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${data.quantity}\n` +
              `‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞: ${data.totalAmount.toLocaleString()} ‡∏ö‡∏≤‡∏ó\n` +
              `üéâ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πâ‡∏°: ${data.pointsEarned} ‡πÅ‡∏ï‡πâ‡∏°\n\n` +
              `‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏∞ üôè`
      };
      
      liff.sendMessages([message]).catch(console.error);
    }
    
    // ========== UTILITY FUNCTIONS ==========
    function updateDateTime() {
      const now = new Date();
      const thaiDate = now.toLocaleDateString('th-TH', {
        day: 'numeric',
        month: 'short',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
      document.getElementById('currentDateTime').textContent = thaiDate;
    }
    
    function updateConnectionStatus(status) {
      const statusEl = document.getElementById('connectionStatus');
      if (status === 'connected') {
        statusEl.innerHTML = '<i class="fas fa-circle text-green-400 text-xs mr-2"></i>‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß';
      } else if (status === 'error') {
        statusEl.innerHTML = '<i class="fas fa-circle text-red-400 text-xs mr-2"></i>‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß';
      } else {
        statusEl.innerHTML = '<i class="fas fa-circle text-yellow-400 text-xs mr-2"></i>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...';
      }
    }
    
    function showLoginButton() {
      document.getElementById('loginSection').classList.remove('hidden');
      document.getElementById('customerInfoSection').classList.add('hidden');
    }
    
    function showManualLoginOption() {
      document.getElementById('userName').textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
      showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö LINE ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö', 'info');
    }
    
    async function handleLineLogin() {
      if (liff) {
        liff.login();
      } else {
        window.location.href = 'https://line.me/R/oaMessage/@YOUR_OA/';
      }
    }
    
    function applyReferral() {
      const code = document.getElementById('referralCode').value;
      if (code) {
        showNotification('‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î 10%', 'success');
        document.getElementById('referralCode').classList.add('border-green-500');
        setTimeout(() => {
          document.getElementById('referralCode').classList.remove('border-green-500');
        }, 2000);
      }
    }
    
    function loadCustomerData() {
      // Try to load from localStorage
      const saved = localStorage.getItem('crm_customer');
      if (saved) {
        try {
          const data = JSON.parse(saved);
          currentUser = { ...currentUser, ...data };
          updateCRMDisplay();
        } catch (e) {}
      }
    }
    
    function loadMockOrderHistory() {
      const historyHTML = `
        <div class="timeline-item">
          <span class="timeline-dot"></span>
          <div class="crm-card p-3">
            <div class="flex justify-between">
              <div>
                <p class="text-white font-medium">Premium Set</p>
                <p class="text-xs text-gray-400">12 ‡∏°‡∏µ.‡∏Ñ. 2026</p>
              </div>
              <div class="text-right">
                <span class="text-green-400 text-xs">‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß</span>
                <p class="text-white font-bold">3,990</p>
              </div>
            </div>
          </div>
        </div>
        <div class="timeline-item">
          <span class="timeline-dot"></span>
          <div class="crm-card p-3">
            <div class="flex justify-between">
              <div>
                <p class="text-white font-medium">Standard Set</p>
                <p class="text-xs text-gray-400">5 ‡∏°‡∏µ.‡∏Ñ. 2026</p>
              </div>
              <div class="text-right">
                <span class="text-blue-400 text-xs">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</span>
                <p class="text-white font-bold">2,490</p>
              </div>
            </div>
          </div>
        </div>
      `;
      document.getElementById('orderHistoryList').innerHTML = historyHTML;
    }
    
    // ========== NOTIFICATION FUNCTIONS ==========
    function showLoading() {
      Swal.fire({
        title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',
        html: '<div class="loading-spinner mx-auto"></div>',
        showConfirmButton: false,
        allowOutsideClick: false,
        background: '#1a1e24',
        color: 'white'
      });
    }
    
    function hideLoading() {
      Swal.close();
    }
    
    function showNotification(message, type = 'info') {
      const config = {
        icon: type,
        title: type === 'success' ? '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : type === 'error' ? '‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î' : '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
        text: message,
        timer: 2000,
        showConfirmButton: false,
        background: '#1a1e24',
        color: 'white',
        iconColor: type === 'success' ? '#4ade80' : type === 'error' ? '#ef4444' : '#4a90e2'
      };
      
      Swal.fire(config);
    }
    
    function showSuccess(points) {
      Swal.fire({
        icon: 'success',
        title: '‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
        html: `<div class="text-center">
                 <p class="text-gray-300 mb-2">‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°</p>
                 <p class="text-3xl font-bold text-blue-400 mb-2">+${points}</p>
               </div>`,
        timer: 2500,
        showConfirmButton: false,
        background: '#1a1e24',
        color: 'white',
        iconColor: '#4ade80'
      });
    }
    
    // ========== ACTION FUNCTIONS ==========
    function openChat() {
      const url = 'https://line.me/R/oaMessage/@YOUR_OA/';
      if (liff && liff.isInClient()) {
        liff.openWindow({ url, external: true });
      } else {
        window.open(url, '_blank');
      }
    }
    
    function checkPoints() {
      showNotification(`‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: ${currentUser.points.toLocaleString()} ‡πÅ‡∏ï‡πâ‡∏°`, 'info');
    }
    
    function viewHistory() {
      // Switch to history tab or show modal
      showNotification('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠...', 'info');
    }
    
    function viewAllHistory() {
      viewHistory();
    }
    
    function copyReferralCode() {
      const code = document.getElementById('userReferralCode').textContent;
      navigator.clipboard.writeText(code).then(() => {
        showNotification('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
      });
    }
    
    // ========== EXPORT GLOBALS ==========
    window.selectSize = selectSize;
    window.decreaseQuantity = decreaseQuantity;
    window.increaseQuantity = increaseQuantity;
    window.updatePoints = updatePoints;
    window.handleOrderSubmit = handleOrderSubmit;
    window.handleLineLogin = handleLineLogin;
    window.applyReferral = applyReferral;
    window.openChat = openChat;
    window.checkPoints = checkPoints;
    window.viewHistory = viewHistory;
    window.viewAllHistory = viewAllHistory;
    window.copyReferralCode = copyReferralCode;
  </script>
  
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
</html>
