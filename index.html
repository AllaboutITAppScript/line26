<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LINE CRM ¬∑ Dark Mode</title>
    
    <!-- TailwindCSS + Dark mode -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome 6 (‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏™‡∏ß‡∏¢) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Google Apps Script (inline fetch) -->
    <style>
        /* Custom smooth scroll & glassmorphism */
        body {
            transition: background-color 0.3s ease, color 0.3s ease;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .dark .glass-card {
            background: rgba(17, 25, 40, 0.75);
            border: 1px solid rgba(255,255,255,0.05);
        }
        .neo-btn {
            transition: all 0.2s;
        }
        .neo-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.3);
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    </style>
</head>
<body class="bg-slate-100 dark:bg-slate-900 text-slate-800 dark:text-slate-100 antialiased">

    <!-- ‡πÅ‡∏ñ‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô Navbar ‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢ + toggle dark mode -->
    <nav class="glass-card fixed top-0 left-0 right-0 z-50 px-6 py-3 mx-4 mt-4 rounded-2xl shadow-xl backdrop-blur-lg">
        <div class="flex items-center justify-between max-w-7xl mx-auto">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                    <i class="fas fa-message text-white text-xl"></i>
                </div>
                <h1 class="text-2xl font-bold bg-gradient-to-r from-indigo-300 to-purple-300 bg-clip-text text-transparent drop-shadow-sm">
                    LINE<span class="text-white/90"> CRM</span>
                </h1>
                <span class="bg-emerald-500/20 text-emerald-300 px-3 py-1 rounded-full text-xs font-semibold border border-emerald-500/30 ml-3">
                    <i class="fas fa-robot mr-1"></i> Auto LINE SDK
                </span>
            </div>
            <div class="flex items-center gap-4">
                <button id="setupDbBtn" class="relative group px-5 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl text-sm font-medium transition-all shadow-lg shadow-indigo-600/30 neo-btn flex items-center gap-2">
                    <i class="fas fa-database"></i> Setup Database
                    <span class="absolute -top-1 -right-1 flex h-3 w-3">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-indigo-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-3 w-3 bg-indigo-500"></span>
                    </span>
                </button>
                <button id="darkToggle" class="w-10 h-10 rounded-xl bg-white/10 dark:bg-slate-800/60 backdrop-blur flex items-center justify-center border border-white/20 shadow-lg hover:bg-white/20 transition">
                    <i class="fas fa-moon dark:hidden text-indigo-300"></i>
                    <i class="fas fa-sun hidden dark:block text-yellow-300"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero / ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ -->
    <div class="pt-28 pb-6 px-4 max-w-7xl mx-auto">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-5 mb-8">
            <div class="glass-card rounded-2xl p-5 backdrop-blur-xl border border-white/10 shadow-xl">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-slate-400 text-sm">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                        <p id="totalUsers" class="text-3xl font-bold mt-1 text-white">0</p>
                    </div>
                    <div class="w-12 h-12 bg-indigo-600/30 rounded-2xl flex items-center justify-center text-indigo-300 text-2xl backdrop-blur">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
            </div>
            <div class="glass-card rounded-2xl p-5 backdrop-blur-xl border border-white/10 shadow-xl">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-slate-400 text-sm">‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏ú‡∏π‡∏Å‡πÑ‡∏ß‡πâ</p>
                        <p id="totalEmails" class="text-3xl font-bold mt-1 text-white">0</p>
                    </div>
                    <div class="w-12 h-12 bg-purple-600/30 rounded-2xl flex items-center justify-center text-purple-300 text-2xl backdrop-blur">
                        <i class="fas fa-envelope"></i>
                    </div>
                </div>
            </div>
            <div class="glass-card rounded-2xl p-5 backdrop-blur-xl border border-white/10 shadow-xl">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-slate-400 text-sm">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE</p>
                        <p id="totalLine" class="text-3xl font-bold mt-1 text-white">0</p>
                    </div>
                    <div class="w-12 h-12 bg-emerald-600/30 rounded-2xl flex items-center justify-center text-emerald-300 text-2xl backdrop-blur">
                        <i class="fab fa-line"></i>
                    </div>
                </div>
            </div>
            <div class="glass-card rounded-2xl p-5 backdrop-blur-xl border border-white/10 shadow-xl">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-slate-400 text-sm">‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ä‡∏ó</p>
                        <p id="inactiveUsers" class="text-3xl font-bold mt-1 text-white">0</p>
                    </div>
                    <div class="w-12 h-12 bg-amber-600/30 rounded-2xl flex items-center justify-center text-amber-300 text-2xl backdrop-blur">
                        <i class="fas fa-clock"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏•‡∏±‡∏Å: ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ / ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• LINE -->
        <div class="glass-card rounded-3xl p-6 md:p-8 backdrop-blur-2xl border border-white/10 shadow-2xl">
            <div class="flex flex-col md:flex-row md:items-center justify-between mb-7 gap-4">
                <div class="flex items-center gap-3">
                    <div class="w-11 h-11 bg-gradient-to-br from-indigo-500/30 to-purple-600/30 rounded-2xl flex items-center justify-center">
                        <i class="fas fa-address-book text-indigo-300 text-xl"></i>
                    </div>
                    <h2 class="text-xl font-semibold">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ¬∑ LINE Integration</h2>
                </div>
                <div class="flex gap-3">
                    <button id="refreshData" class="px-5 py-2.5 bg-white/5 hover:bg-white/10 rounded-xl text-sm font-medium border border-white/10 transition-all flex items-center gap-2 backdrop-blur">
                        <i class="fas fa-rotate"></i> ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                    </button>
                    <button id="syncLineProfiles" class="px-5 py-2.5 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 rounded-xl text-sm font-medium shadow-lg shadow-indigo-600/30 transition-all flex items-center gap-2 neo-btn">
                        <i class="fab fa-line"></i> Sync LINE Profiles
                    </button>
                </div>
            </div>

            <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CRM ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° -->
            <div class="overflow-x-auto rounded-2xl border border-white/10">
                <table class="w-full text-sm">
                    <thead class="bg-black/40 backdrop-blur-sm text-slate-300">
                        <tr>
                            <th class="px-6 py-4 text-left font-medium"><i class="fas fa-user mr-2"></i>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ LINE</th>
                            <th class="px-6 py-4 text-left font-medium"><i class="fas fa-id-card mr-2"></i>LINE User ID</th>
                            <th class="px-6 py-4 text-left font-medium"><i class="fas fa-envelope mr-2"></i>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                            <th class="px-6 py-4 text-left font-medium"><i class="fas fa-image mr-2"></i>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</th>
                            <th class="px-6 py-4 text-left font-medium"><i class="fas fa-calendar mr-2"></i>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï</th>
                            <th class="px-6 py-4 text-left font-medium"><i class="fas fa-cog mr-2"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="crmTableBody" class="divide-y divide-white/5">
                        <!-- JavaScript ‡∏à‡∏∞ inject ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
                        <tr class="hover:bg-white/5 transition">
                            <td colspan="6" class="px-6 py-10 text-center text-slate-400">
                                <i class="fas fa-spinner fa-pulse text-2xl mb-2"></i>
                                <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Apps Script...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á footer ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô -->
            <div class="mt-5 text-xs text-slate-500 flex justify-between items-center">
                <span><i class="fas fa-shield-alt mr-1"></i> ‡∏î‡∏∂‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå LINE ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏î‡πâ‡∏ß‡∏¢ LINE SDK</span>
                <span class="bg-white/5 px-4 py-2 rounded-full">‚ú® ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô | Dark mode | Tailwind</span>
            </div>
        </div>
    </div>

    <!-- Google Apps Script API endpoint (‡∏Ç‡∏≠‡∏á‡∏à‡∏≥‡∏•‡∏≠‡∏á, ‡πÅ‡∏ï‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô GAS Web App URL ‡∏à‡∏£‡∏¥‡∏á) -->
    <script>
        // ============================================================
        // ‚ö°Ô∏è ‡∏à‡∏≥‡∏•‡∏≠‡∏á Google Apps Script Endpoint (PRODUCTION ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL)
        // ============================================================
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbzXx9x_sample_simulate/exec'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

        // ========== Global State & Dark Mode ==========
        let crmData = [];

        // Dark mode toggle
        const darkToggle = document.getElementById('darkToggle');
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
        darkToggle.addEventListener('click', () => {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
            }
        });

        // ========== ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏Å GAS (Google Apps Script) ==========
        async function callGAS(action, payload = {}) {
            // ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ä‡πâ fetch ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° ‡∏û‡∏£‡πâ‡∏≠‡∏° LINE Profile mock
            // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Production: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô fetch(GAS_URL, {method: 'POST', body: JSON.stringify({action, ...payload})})
            return new Promise((resolve) => {
                setTimeout(() => {
                    if (action === 'setupDatabase') {
                        resolve({ success: true, message: 'Database initialized' });
                    } else if (action === 'getAllUsers') {
                        // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CRM + LINE profile (mock) ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ SDK ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                        resolve({
                            users: [
                                { lineUserId: 'U12345abcde', displayName: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ', email: 'somchai@example.com', pictureUrl: 'https://via.placeholder.com/150/4f46e5/ffffff?text=‡∏™‡∏°‡∏ä‡∏≤‡∏¢', lastUpdated: '2025-03-15', status: 'active' },
                                { lineUserId: 'U67890fghij', displayName: '‡∏ß‡∏¥‡∏ä‡∏ç‡∏≤‡∏û‡∏£ ‡∏®‡∏£‡∏µ‡∏™‡∏∏‡∏Ç', email: 'witchayaporn@example.com', pictureUrl: 'https://via.placeholder.com/150/7c3aed/ffffff?text=‡∏ß‡∏¥‡∏ä‡∏ç‡∏≤', lastUpdated: '2025-03-16', status: 'active' },
                                { lineUserId: 'U11223klmno', displayName: '‡∏≠‡∏ô‡∏±‡∏ô‡∏ï‡πå ‡∏£‡∏±‡∏Å‡∏î‡∏µ', email: 'anant@example.com', pictureUrl: 'https://via.placeholder.com/150/db2777/ffffff?text=‡∏≠‡∏ô‡∏±‡∏ô‡∏ï‡πå', lastUpdated: '2025-03-10', status: 'inactive' },
                                { lineUserId: 'U44556pqrst', displayName: '‡∏™‡∏∏‡∏î‡∏≤ ‡∏£‡∏ß‡∏¢‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå', email: 'suda@example.com', pictureUrl: 'https://via.placeholder.com/150/ea580c/ffffff?text=‡∏™‡∏∏‡∏î‡∏≤', lastUpdated: '2025-03-17', status: 'active' },
                                { lineUserId: 'U77889uvwxy', displayName: '‡∏°‡∏≤‡∏ô‡∏∞ ‡∏Ç‡∏¢‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', email: 'mana@example.com', pictureUrl: 'https://via.placeholder.com/150/16a34a/ffffff?text=‡∏°‡∏≤‡∏ô‡∏∞', lastUpdated: '2025-03-12', status: 'active' },
                                { lineUserId: 'U99010zabcd', displayName: '‡∏û‡∏¥‡∏°‡∏•‡∏ß‡∏£‡∏£‡∏ì ‡∏™‡∏∏‡∏Ç‡πÉ‡∏à', email: 'pimonwan@example.com', pictureUrl: 'https://via.placeholder.com/150/b45309/ffffff?text=‡∏û‡∏¥‡∏°‡∏•', lastUpdated: '2025-03-08', status: 'inactive' },
                            ]
                        });
                    } else if (action === 'syncLine') {
                        // ‡∏à‡∏≥‡∏•‡∏≠‡∏á sync ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å LINE SDK
                        resolve({
                            success: true,
                            newProfiles: [
                                { lineUserId: 'U55667efghi', displayName: '‡∏Å‡∏§‡∏©‡∏é‡∏≤ ‡∏ô‡∏ß‡∏Å‡∏∏‡∏•', email: 'kritsada@example.com', pictureUrl: 'https://via.placeholder.com/150/a21caf/ffffff?text=‡∏Å‡∏§‡∏©‡∏é‡∏≤', lastUpdated: new Date().toISOString().slice(0,10), status: 'active' }
                            ]
                        });
                    }
                }, 800); // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏î‡∏µ‡πÄ‡∏•‡∏¢‡πå
            });
        }

        // ========== Setup Database ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô ==========
        async function setupDatabase() {
            const btn = document.getElementById('setupDbBtn');
            btn.innerHTML = `<i class="fas fa-spinner fa-pulse"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á...`;
            btn.disabled = true;
            try {
                const res = await callGAS('setupDatabase');
                alert('‚úÖ Setup Database ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
            } catch (e) {
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e.message);
            } finally {
                btn.innerHTML = `<i class="fas fa-database"></i> Setup Database`;
                btn.disabled = false;
            }
        }

        // ========== ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á + ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ ==========
        async function loadCRMData() {
            const tbody = document.getElementById('crmTableBody');
            tbody.innerHTML = `<tr><td colspan="6" class="px-6 py-12 text-center text-slate-400">
                <i class="fas fa-spinner fa-pulse text-3xl mb-3"></i>
                <p class="text-base">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• LINE Profiles ‡∏à‡∏≤‡∏Å SDK ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥...</p>
            </td></tr>`;

            try {
                const res = await callGAS('getAllUsers');
                crmData = res.users || [];
                renderTable(crmData);
                updateStats(crmData);
            } catch (error) {
                tbody.innerHTML = `<tr><td colspan="6" class="px-6 py-12 text-center text-rose-400">
                    <i class="fas fa-exclamation-triangle text-3xl mb-3"></i>
                    <p class="text-base">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${error.message}</p>
                </td></tr>`;
            }
        }

        // ========== ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á 4 ‡∏Å‡∏≤‡∏£‡πå‡∏î ==========
        function updateStats(users) {
            document.getElementById('totalUsers').innerText = users.length;
            const withEmail = users.filter(u => u.email && u.email !== '').length;
            document.getElementById('totalEmails').innerText = withEmail;
            document.getElementById('totalLine').innerText = users.length; // ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏°‡∏µ line userId
            const inactive = users.filter(u => u.status === 'inactive').length;
            document.getElementById('inactiveUsers').innerText = inactive;
        }

        // ========== ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° ==========
        function renderTable(users) {
            const tbody = document.getElementById('crmTableBody');
            if (!users || users.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" class="px-6 py-12 text-center text-slate-400">
                    <i class="fas fa-user-slash text-3xl mb-3"></i>
                    <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£ Sync LINE Profiles</p>
                </td></tr>`;
                return;
            }

            let html = '';
            users.forEach(user => {
                const statusClass = user.status === 'active' ? 'bg-emerald-500/20 text-emerald-300 border-emerald-500/30' : 'bg-slate-500/20 text-slate-400 border-slate-500/30';
                const statusIcon = user.status === 'active' ? 'fa-circle' : 'fa-circle-dot';
                
                html += `<tr class="hover:bg-white/5 transition-all border-b border-white/5 last:border-0">
                    <td class="px-6 py-4 font-medium">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-gradient-to-br from-indigo-400 to-purple-600 flex items-center justify-center text-white shadow-md">
                                <i class="fas fa-user text-xs"></i>
                            </div>
                            ${user.displayName || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠'}
                        </div>
                    </td>
                    <td class="px-6 py-4 font-mono text-xs text-slate-300">${user.lineUserId || '-'}</td>
                    <td class="px-6 py-4">
                        <span class="bg-indigo-600/20 text-indigo-200 px-3 py-1.5 rounded-lg text-xs border border-indigo-500/30 flex items-center gap-1 w-fit">
                            <i class="fas fa-envelope text-[10px]"></i> ${user.email || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏µ‡πÄ‡∏°‡∏•'}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-2">
                            <img src="${user.pictureUrl || 'https://via.placeholder.com/100/2d3748/ffffff?text=LINE'}" 
                                 class="w-8 h-8 rounded-full border-2 border-indigo-500/50 shadow-lg object-cover"
                                 onerror="this.src='https://via.placeholder.com/100/2d3748/ffffff?text=no'">
                            <span class="text-xs text-slate-400">LINE</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 text-slate-400 text-xs">${user.lastUpdated || '-'}</td>
                    <td class="px-6 py-4">
                        <div class="flex gap-2">
                            <button class="w-8 h-8 rounded-lg bg-white/5 hover:bg-indigo-600/30 border border-white/10 flex items-center justify-center transition" title="‡∏î‡∏π‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå">
                                <i class="fas fa-eye text-indigo-300 text-xs"></i>
                            </button>
                            <button class="w-8 h-8 rounded-lg bg-white/5 hover:bg-emerald-600/30 border border-white/10 flex items-center justify-center transition" title="‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°">
                                <i class="fab fa-line text-emerald-300 text-xs"></i>
                            </button>
                            <span class="${statusClass} px-2 py-1 rounded-full text-[10px] font-medium border flex items-center gap-1">
                                <i class="fas ${statusIcon}"></i> ${user.status}
                            </span>
                        </div>
                    </td>
                </tr>`;
            });
            tbody.innerHTML = html;
        }

        // ========== Sync LINE Profiles (‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å SDK ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥) ==========
        async function syncLineProfiles() {
            const syncBtn = document.getElementById('syncLineProfiles');
            const originalText = syncBtn.innerHTML;
            syncBtn.innerHTML = '<i class="fas fa-spinner fa-pulse"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á Sync...';
            syncBtn.disabled = true;

            try {
                const result = await callGAS('syncLine');
                if (result.success) {
                    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡∏£‡∏ß‡∏° profile ‡πÉ‡∏´‡∏°‡πà)
                    await loadCRMData();
                    alert(`‚úÖ Sync ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà ${result.newProfiles?.length || 0} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
                }
            } catch (e) {
                alert('Sync ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + e.message);
            } finally {
                syncBtn.innerHTML = originalText;
                syncBtn.disabled = false;
            }
        }

        // ========== Event Listeners ==========
        document.getElementById('setupDbBtn').addEventListener('click', setupDatabase);
        document.getElementById('refreshData').addEventListener('click', loadCRMData);
        document.getElementById('syncLineProfiles').addEventListener('click', syncLineProfiles);

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
        window.addEventListener('DOMContentLoaded', () => {
            loadCRMData();
        });
    </script>

    <!-- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Deployment note -->
    <div class="max-w-7xl mx-auto px-4 pb-8 mt-5 text-center text-slate-500 text-xs border-t border-white/10 pt-6">
        <p class="flex items-center justify-center gap-4">
            <span><i class="fas fa-check-circle text-emerald-400"></i> ‡∏î‡∏≤‡∏£‡πå‡∏Å‡πÇ‡∏°‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</span>
            <span><i class="fas fa-code-branch"></i> TailwindCSS + Glassmorphism</span>
            <span><i class="fas fa-google"></i> Google Apps Script backend</span>
            <span><i class="fab fa-line"></i> LINE SDK simulator</span>
        </p>
        <p class="mt-3 text-indigo-400/70">üìå ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç GAS_URL ‡πÄ‡∏õ‡πá‡∏ô Web App URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÅ‡∏•‡∏∞ implement LINE SDK ‡∏à‡∏£‡∏¥‡∏á (‡πÉ‡∏ä‡πâ callGAS mock)</p>
    </div>
</body>
</html>
